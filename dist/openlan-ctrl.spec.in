Name: openlan-ctrl
Version: VERSION
Release: 1%{?dist}
Summary: OpenLAN's Controller Software
Group: Applications/Communications
License: Apache 2.0
URL: https://github.com/danieldin95/openlan

%define _source_dir ${RPM_SOURCE_DIR}/openlan-%{version}

%description
OpenLan's Project Software

%build
cd %_source_dir && make linux-ctrl

%install
mkdir -p %{buildroot}/usr/bin
cp %_source_dir/build/openlan-ctrl %{buildroot}/usr/bin

mkdir -p %{buildroot}/etc/sysconfig/openlan
cp %_source_dir/dist/resource/ctrl.cfg %{buildroot}/etc/sysconfig/openlan
mkdir -p %{buildroot}/var/openlan/ctrl/cert
cp -R %_source_dir/build/cert/openlan/cert %{buildroot}/var/openlan/ctrl

mkdir -p %{buildroot}/etc/openlan/ctrl
cp %_source_dir/dist/resource/auth.json.example %{buildroot}/etc/openlan/ctrl
mkdir -p %{buildroot}/usr/lib/systemd/system
cp %_source_dir/dist/resource/openlan-ctrl.service %{buildroot}/usr/lib/systemd/system

%pre
/usr/bin/firewall-cmd --permanent --zone=public --add-port=10088/tcp || {
  echo "YOU NEED ALLOW TCP PORT:10088."
}
firewall-cmd --reload || :

%files
%defattr(-,root,root)
/etc/sysconfig/*
/etc/openlan/*
/usr/bin/*
/usr/lib/systemd/system/*
/var/openlan/*
